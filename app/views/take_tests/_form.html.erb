<%= form_for @take_test do |form| %>
  <% if @take_test.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(@take_test.errors.count, "error") %> prohibited this take_test from being saved:</h2>

      <ul>
        <% @take_test.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :user_id, :value => session[:user_id] %>
  <% @take_test.user_id = User.find_by(id: @take_test.user_id) %>
  <div class="field">
    <% test = Test.find_by(id: @take_test.test_id) %>
    <% test.open_questions.each do |q| %>
      <%= form.fields_for :take_answers do |builder| %>
        <div>
          <%= q.question %>
          <%= q.id %>
          <%= builder.label :Odpoveď %>
          <%= builder.text_field :user_answer %>
          <%= builder.hidden_field :question_id, :value => q.id.to_i %>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="field">
    <% test.multiple_choice_questions.each do |m| %>
      <%= m.question %>
      <% m.choices.each do |ch| %>


        <%= form.fields_for :take_multiple_choices do |builder| %>
          <div>

            <%= builder.check_box :choice,{multiple: false }, ch.id %><%=ch.answer %>
            <%=builder.hidden_field :is_correct, :value =>ch.is_true %>
            <%=builder.hidden_field :choice_id, :value =>ch.id %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
  <div>
    <%= form.submit %>
  </div>
<% end %>